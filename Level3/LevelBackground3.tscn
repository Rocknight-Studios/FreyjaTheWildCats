[gd_scene load_steps=10 format=2]

[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage0/BackgroundImage0.tscn" type="PackedScene" id=1]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage1/BackgroundImage1.tscn" type="PackedScene" id=2]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage2/BackgroundImage2.tscn" type="PackedScene" id=3]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage3/BackgroundImage3.tscn" type="PackedScene" id=4]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage4/BackgroundImage4.tscn" type="PackedScene" id=5]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage5/BackgroundImage5.tscn" type="PackedScene" id=6]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage6/BackgroundImage6.tscn" type="PackedScene" id=7]
[ext_resource path="res://Level3/LevelBackgrounds/BackgroundImage7/BackgroundImage7.tscn" type="PackedScene" id=8]

[sub_resource type="GDScript" id=1]

script/source = "extends Node2D

export var block_optimization_distance = 2000.0 # Deactivate enemies at this distance.
var blocks = [] # All the enemies of this block.
onready var management_start_time = OS.get_ticks_msec() # To save resources.
var management_pause = 3.0 # How often to check for the new block activity state.
var block_positions = [] # To save resources and have an access to block positions that are removed from the scene tree.

func _ready():
	var child_amount = get_child_count() # For speed and convenience.
	for i in range(0, child_amount):
		blocks.append(get_child(i))
		block_positions.append(blocks[i].get_global_transform().origin)

	yield(get_tree(), \"idle_frame\")
	for i in range(0, child_amount):
		remove_child(blocks[i])
	manage_block_activity()

func _process(delta):
	if OS.get_ticks_msec() - management_start_time > management_pause:
		management_start_time = OS.get_ticks_msec()
		manage_block_activity()

func manage_block_activity():
	for i in range(0, blocks.size()):
		if Global.player.get_global_transform().origin.distance_to(block_positions[i]) > block_optimization_distance:
			if blocks[i].get_parent() != null:
				remove_child(blocks[i])
		elif blocks[i].get_parent() == null:
			add_child(blocks[i])

"

[node name="LevelBackground" type="Node2D"]

position = Vector2( 0, 8 )
script = SubResource( 1 )
_sections_unfolded = [ "Transform" ]
block_optimization_distance = 2000.0

[node name="BackgroundImage0" parent="." index="0" instance=ExtResource( 1 )]

[node name="BackgroundImage1" parent="." index="1" instance=ExtResource( 2 )]

[node name="BackgroundImage2" parent="." index="2" instance=ExtResource( 3 )]

[node name="BackgroundImage3" parent="." index="3" instance=ExtResource( 4 )]

[node name="BackgroundImage4" parent="." index="4" instance=ExtResource( 5 )]

[node name="BackgroundImage5" parent="." index="5" instance=ExtResource( 6 )]

[node name="BackgroundImage6" parent="." index="6" instance=ExtResource( 7 )]

[node name="BackgroundImage7" parent="." index="7" instance=ExtResource( 8 )]


